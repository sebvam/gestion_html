<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Sistema de Gesti√≥n</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
  :root{
    --bg:#f5f6f7;
    --text:#222;
    --muted:#666;
    --accent:#2b7cff;
    --light-border:#e6e6e6;
  }

  body{
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    margin:0;
    background:var(--bg);
    color:var(--text);
  }

  header{
    align-items: center;
    display:flex;
    justify-content:space-between;
    align-items:center;
    height: 40px;
    background:#fff;
    border-bottom:1px solid var(--light-border);
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
  }

  .title{
    font-weight:600;
    font-size:20px;
    letter-spacing:0.3px;
  }

  /* LAYOUT DIVIDIDO */
  .main{
    display:flex;
    height:calc(100vh - 60px);
  }

  /* PANEL IZQUIERDO */
  .left-panel{
    width:36%;
    max-width:420px;
    padding:22px;
    border-right:1px solid var(--light-border);
    background:#fafafa;
    display:flex;
    flex-direction:column;
    gap:20px;
  }



  .controls{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
  }

  button{
    background:var(--accent);
    border:none;
    padding:10px 16px;
    border-radius:8px;
    color:#fff;
    cursor:pointer;
    transition:0.15s ease;
    font-size:14px;
    box-shadow:0 3px 8px rgba(0,0,0,0.12);
  }

  button:hover{
    transform:translateY(-1px);
    box-shadow:0 5px 12px rgba(0,0,0,0.15);
    opacity:0.95;
  }

  button.secondary{
    background:#e6e6e6;
    color:#222;
  }

  ul.file-list{
    list-style:none;
    padding:0;
    margin:0;
  }

  ul.file-list li{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 14px;
    border-radius:10px;
    margin-bottom:10px;
    background:#f5f6f7;
    border:1px solid #e1e1e1;
    transition:0.15s;
  }

  ul.file-list li:hover{
    background:#eef3ff;
    border-color:#d2ddff;
  }

  a.file-link{
    color:var(--text);
    text-decoration:none;
    font-weight:500;
    cursor:pointer;
  }

  /* PANEL DERECHO */
  .viewer-container{
    flex:1;
    display:flex;
    flex-direction:column;
    background:#fff;
  }



  iframe{
    flex:1;
    width:100%;
    border:none;
    background:#ffffff;
  }

  .botones{
    margin: 0px 0px 20px 20px;
    height: 12px;
  }

</style>
</head>

<body>
<header>
  <div class="controls">
    <div class="botones">
    <button class="upload"id="uploadBtn">Subir archivo</button>
    <button id="refreshBtn" class="secondary">Actualizar</button>
    <button id="closeViewerBtn" class="secondary">Cerrar vista</button>
    </div>
  </div>

</header>

<div class="main">

  <!-- PANEL IZQUIERDO -->
  <div class="left-panel">

    <div class="card">
      <ul id="fileList" class="file-list"></ul>
    </div>

  </div>

  <!-- PANEL DERECHO -->
  <div class="viewer-container">



    <iframe id="viewer"></iframe>

  </div>

</div>

<script>
async function apiCall(name, ...args){
  try{
    const fn = window.pywebview.api[name];
    return await fn(...args);
  }catch(e){
    console.error(e);
    return null;
  }
}

async function loadFiles(){
  const files = await apiCall('list_files') || [];
  const list = document.getElementById('fileList');
  list.innerHTML = '';
  
  files.forEach(f => {
    const li = document.createElement('li');

    const a = document.createElement('a');
    a.textContent = f;
    a.className = 'file-link';

    a.onclick = async () => {
      const ruta = await apiCall('abrir_archivo', f);
      if (ruta){
        document.getElementById('viewer').src = ruta;
      }
    };

    li.appendChild(a);

    const actions = document.createElement('div');
    const del = document.createElement('button');
    del.textContent = 'Eliminar';
    del.onclick = async () => {
      await apiCall('delete_file', f);
      await loadFiles();
      document.getElementById('viewer').src = "";
    };
    actions.appendChild(del);

    li.appendChild(actions);
    list.appendChild(li);
  });
}

document.getElementById('uploadBtn').onclick = async () => {
  await apiCall('upload_file');
  await loadFiles();
};

document.getElementById('refreshBtn').onclick = loadFiles;

document.getElementById('closeViewerBtn').onclick = () => {
  document.getElementById('viewer').src = "";
};

// INICIO
(async ()=>{
  await loadFiles();
})();
</script>

</body>
</html>
